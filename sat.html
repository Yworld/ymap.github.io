<!DOCTYPE html>
<html>
  <head>
    <title>Карта ЮМира: Спутники</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <script src="/js/head.load.min.js"></script>
    <script>
    head.load("https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css", "https://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.1.4.min.js", function() {
        head.load("https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true&callback=initialize", "/js/module/switcher.js");
        window.smallterritoriesloaded = false; window.poistatus = false;
});
/* мапа */
function initialize() {
  var mapOptions = {
    zoom: 3,
    center: new google.maps.LatLng(54.9382099, 43.3239641),
    styles: [{"featureType":"administrative.country","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"administrative.province","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"administrative.locality","elementType":"all","stylers":[{"visibility":"on"}]},{"featureType":"poi","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"poi.medical","elementType":"all","stylers":[{"visibility":"on"}]},{"featureType":"poi.government","elementType":"all","stylers":[{"visibility":"on"}]},{"featureType":"poi.park","elementType":"all","stylers":[{"visibility":"on"}]},{"featureType":"poi.place_of_worship","elementType":"all","stylers":[{"visibility":"on"}]},{"featureType":"poi.school","elementType":"all","stylers":[{"visibility":"on"}]},{"featureType":"poi.school","elementType":"all","stylers":[{"visibility":"on"}]},{"featureType":"poi.sports_complex","elementType":"all","stylers":[{"visibility":"on"}]},{"featureType":"poi.attraction","elementType":"all","stylers":[{"visibility":"on"}]},{"featureType":"transit.station.rail","elementType":"all","stylers":[{"visibility":"on"},{"gamma":3.17}]}]
  };
  

  var map = new google.maps.Map(document.getElementById('map-canvas'),
      mapOptions);
  map.data.loadGeoJson('http://карта.юмир.рф/borders.json');
  
  var featureStyle = {
    strokeWeight: 0.7
  }
                     map.data.setStyle(featureStyle);


// Load countries
        $.getJSON("/data/countries.json", function(json1) {
          for (var i = 0, length = json1.length; i < length; i++) {
  var data = json1[i],
      latLng = new google.maps.LatLng(data.lat, data.lng); 

  // Creating a marker and putting it on the map
  var marker = new google.maps.Marker({
    position: latLng,
    map: map,
    title: data.title,
    icon: data.icon,
    opacity: 0.5
  });
}
      });
    console.log('[FINE] Countries loaded from /data/countries.json!');
    
// Load smallterritories
google.maps.event.addListener(map, 'zoom_changed', function() {
var zoomLevel =  map.getZoom();
console.log('Wow! '+zoomLevel)
if (zoomLevel>=7) {
    if(window.smallterritoriesloaded == true) {
        // Уже было загружено
    }
    else {
     $.getJSON("/data/smallterritories.json", function(json2) {
          for (var i = 0, length = json2.length; i < length; i++) {
  var data = json2[i],
      latLng = new google.maps.LatLng(data.lat, data.lng); 

  // Creating a marker and putting it on the map
  var marker = new google.maps.Marker({
    position: latLng,
    map: map,
    title: data.title,
    icon: data.icon,
    opacity: 0.5
  });
}
 console.log('[FINE] Small territories loaded from /data/smallterritories.json!');
 window.smallterritoriesloaded = true;
});
}
}

if (zoomLevel>=14) {
    if(window.poistatus == true) {
        // Уже было загружено
    }
    else {
     $.getJSON("/data/poi.json", function(json3) {
          for (var i = 0, length = json3.length; i < length; i++) {
  var data = json3[i],
      latLng = new google.maps.LatLng(data.lat, data.lng); 
  // Creating a marker and putting it on the map
  var marker = new google.maps.Marker({
    position: latLng,
    map: map,
    title: data.title
  });
}
 console.log('[FINE] POI loaded from /data/poi.json!');
 window.poistatus = true;
});
}
}

});


   var georssLayer = new google.maps.KmlLayer({
    url: 'http://xn--80aa2azak.xn--h1ahn7c.xn--p1ai/kmz/space.kmz'
  });
  georssLayer.setMap(map);
  
  
}
    </script>
    <style>
            html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
    </style>
  </head>
  <body>
    <div id="map-canvas"></div>
  </body>
     <!-- <script src="https://maps.utenia.ru/require.js" data-main="rq"></script> -->
</html>
